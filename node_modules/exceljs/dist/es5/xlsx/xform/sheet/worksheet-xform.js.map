<<<<<<< HEAD
{"version":3,"sources":["../../../../../lib/xlsx/xform/sheet/worksheet-xform.js"],"names":["_","require","colCache","XmlStream","RelType","Merges","BaseXform","ListXform","RowXform","ColXform","DimensionXform","HyperlinkXform","MergeCellXform","DataValidationsXform","SheetPropertiesXform","SheetFormatPropertiesXform","SheetViewXform","SheetProtectionXform","PageMarginsXform","PageSetupXform","PrintOptionsXform","AutoFilterXform","PictureXform","DrawingXform","TablePartXform","RowBreaksXform","HeaderFooterXform","ConditionalFormattingsXform","ExtListXform","mergeRule","rule","extRule","Object","keys","forEach","key","value","extValue","undefined","mergeConditionalFormattings","model","extModel","length","cfMap","ruleMap","cf","ref","rules","x14Id","extCf","push","WorkSheetXform","options","maxRows","maxCols","map","sheetPr","dimension","sheetViews","tag","count","childXform","sheetFormatPr","cols","sheetData","empty","maxItems","autoFilter","mergeCells","rowBreaks","hyperlinks","pageMargins","dataValidations","pageSetup","headerFooter","printOptions","picture","drawing","sheetProtection","tableParts","conditionalFormatting","extLst","merges","comments","formulae","siFormulae","prepare","rows","conditionalFormattings","rels","nextRid","r","hyperlink","rId","Id","Type","Hyperlink","Target","target","TargetMode","comment","Comments","id","vmlDrawing","VmlDrawing","item","refAddress","decodeAddress","commentRefs","commentName","drawingRelsHash","bookImage","media","medium","type","imageId","Image","name","extension","background","image","drawingsCount","anchors","drawings","rIdImage","preImageId","anchor","range","rIdHyperLink","tooltip","tables","table","Table","columns","column","style","dxfId","styles","addDxfStyle","xmlStream","openXml","StdDocAttributes","openNode","WORKSHEET_ATTRIBUTES","sheetFormatPropertiesModel","properties","defaultRowHeight","dyDescent","outlineLevelCol","outlineLevelRow","defaultColWidth","sheetPropertiesModel","outlineProperties","tabColor","fitToPage","pageMarginsModel","margins","printOptionsModel","showRowColHeaders","showGridLines","horizontalCentered","verticalCentered","sheetProtectionModel","render","dimensions","views","rel","leafNode","closeNode","node","parser","parseOpen","each","xform","reset","text","parseText","parseClose","sheetProperties","assign","relationships","reduce","h","vmlComment","vmlDrawings","index","note","commentsMap","hyperlinkMap","address","filter","Boolean","row","cells","reconcile","drawingRel","match","drawingName","backgroundRel","split","mediaIndex","tablePart","xmlns","module","exports"],"mappings":"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","sourcesContent":["const _ = require('../../../utils/under-dash');\r\n\r\nconst colCache = require('../../../utils/col-cache');\r\nconst XmlStream = require('../../../utils/xml-stream');\r\n\r\nconst RelType = require('../../rel-type');\r\n\r\nconst Merges = require('./merges');\r\n\r\nconst BaseXform = require('../base-xform');\r\nconst ListXform = require('../list-xform');\r\nconst RowXform = require('./row-xform');\r\nconst ColXform = require('./col-xform');\r\nconst DimensionXform = require('./dimension-xform');\r\nconst HyperlinkXform = require('./hyperlink-xform');\r\nconst MergeCellXform = require('./merge-cell-xform');\r\nconst DataValidationsXform = require('./data-validations-xform');\r\nconst SheetPropertiesXform = require('./sheet-properties-xform');\r\nconst SheetFormatPropertiesXform = require('./sheet-format-properties-xform');\r\nconst SheetViewXform = require('./sheet-view-xform');\r\nconst SheetProtectionXform = require('./sheet-protection-xform');\r\nconst PageMarginsXform = require('./page-margins-xform');\r\nconst PageSetupXform = require('./page-setup-xform');\r\nconst PrintOptionsXform = require('./print-options-xform');\r\nconst AutoFilterXform = require('./auto-filter-xform');\r\nconst PictureXform = require('./picture-xform');\r\nconst DrawingXform = require('./drawing-xform');\r\nconst TablePartXform = require('./table-part-xform');\r\nconst RowBreaksXform = require('./row-breaks-xform');\r\nconst HeaderFooterXform = require('./header-footer-xform');\r\nconst ConditionalFormattingsXform = require('./cf/conditional-formattings-xform');\r\nconst ExtListXform = require('./ext-lst-xform');\r\n\r\nconst mergeRule = (rule, extRule) => {\r\n  Object.keys(extRule).forEach(key => {\r\n    const value = rule[key];\r\n    const extValue = extRule[key];\r\n    if (value === undefined && extValue !== undefined) {\r\n      rule[key] = extValue;\r\n    }\r\n  });\r\n};\r\n\r\nconst mergeConditionalFormattings = (model, extModel) => {\r\n  // conditional formattings are rendered in worksheet.conditionalFormatting and also in\r\n  // worksheet.extLst.ext.x14:conditionalFormattings\r\n  // some (e.g. dataBar) are even spread across both!\r\n  if (!extModel || !extModel.length) {\r\n    return model;\r\n  }\r\n  if (!model || !model.length) {\r\n    return extModel;\r\n  }\r\n\r\n  // index model rules by x14Id\r\n  const cfMap = {};\r\n  const ruleMap = {};\r\n  model.forEach(cf => {\r\n    cfMap[cf.ref] = cf;\r\n    cf.rules.forEach(rule => {\r\n      const {x14Id} = rule;\r\n      if (x14Id) {\r\n        ruleMap[x14Id] = rule;\r\n      }\r\n    });\r\n  });\r\n\r\n  extModel.forEach(extCf => {\r\n    extCf.rules.forEach(extRule => {\r\n      const rule = ruleMap[extRule.x14Id];\r\n      if (rule) {\r\n        // merge with matching rule\r\n        mergeRule(rule, extRule);\r\n      } else if (cfMap[extCf.ref]) {\r\n        // reuse existing cf ref\r\n        cfMap[extCf.ref].rules.push(extRule);\r\n      } else {\r\n        // create new cf\r\n        model.push({\r\n          ref: extCf.ref,\r\n          rules: [extRule],\r\n        });\r\n      }\r\n    });\r\n  });\r\n\r\n  // need to cope with rules in extModel that don't exist in model\r\n  return model;\r\n};\r\n\r\nclass WorkSheetXform extends BaseXform {\r\n  constructor(options) {\r\n    super();\r\n\r\n    const {maxRows, maxCols} = options || {};\r\n    this.map = {\r\n      sheetPr: new SheetPropertiesXform(),\r\n      dimension: new DimensionXform(),\r\n      sheetViews: new ListXform({\r\n        tag: 'sheetViews',\r\n        count: false,\r\n        childXform: new SheetViewXform(),\r\n      }),\r\n      sheetFormatPr: new SheetFormatPropertiesXform(),\r\n      cols: new ListXform({tag: 'cols', count: false, childXform: new ColXform()}),\r\n      sheetData: new ListXform({\r\n        tag: 'sheetData',\r\n        count: false,\r\n        empty: true,\r\n        childXform: new RowXform({maxItems: maxCols}),\r\n        maxItems: maxRows,\r\n      }),\r\n      autoFilter: new AutoFilterXform(),\r\n      mergeCells: new ListXform({tag: 'mergeCells', count: true, childXform: new MergeCellXform()}),\r\n      rowBreaks: new RowBreaksXform(),\r\n      hyperlinks: new ListXform({\r\n        tag: 'hyperlinks',\r\n        count: false,\r\n        childXform: new HyperlinkXform(),\r\n      }),\r\n      pageMargins: new PageMarginsXform(),\r\n      dataValidations: new DataValidationsXform(),\r\n      pageSetup: new PageSetupXform(),\r\n      headerFooter: new HeaderFooterXform(),\r\n      printOptions: new PrintOptionsXform(),\r\n      picture: new PictureXform(),\r\n      drawing: new DrawingXform(),\r\n      sheetProtection: new SheetProtectionXform(),\r\n      tableParts: new ListXform({tag: 'tableParts', count: true, childXform: new TablePartXform()}),\r\n      conditionalFormatting: new ConditionalFormattingsXform(),\r\n      extLst: new ExtListXform(),\r\n    };\r\n  }\r\n\r\n  prepare(model, options) {\r\n    options.merges = new Merges();\r\n    model.hyperlinks = options.hyperlinks = [];\r\n    model.comments = options.comments = [];\r\n\r\n    options.formulae = {};\r\n    options.siFormulae = 0;\r\n    this.map.cols.prepare(model.cols, options);\r\n    this.map.sheetData.prepare(model.rows, options);\r\n    this.map.conditionalFormatting.prepare(model.conditionalFormattings, options);\r\n\r\n    model.mergeCells = options.merges.mergeCells;\r\n\r\n    // prepare relationships\r\n    const rels = (model.rels = []);\r\n\r\n    function nextRid(r) {\r\n      return `rId${r.length + 1}`;\r\n    }\r\n\r\n    model.hyperlinks.forEach(hyperlink => {\r\n      const rId = nextRid(rels);\r\n      hyperlink.rId = rId;\r\n      rels.push({\r\n        Id: rId,\r\n        Type: RelType.Hyperlink,\r\n        Target: hyperlink.target,\r\n        TargetMode: 'External',\r\n      });\r\n    });\r\n\r\n    // prepare comment relationships\r\n    if (model.comments.length > 0) {\r\n      const comment = {\r\n        Id: nextRid(rels),\r\n        Type: RelType.Comments,\r\n        Target: `../comments${model.id}.xml`,\r\n      };\r\n      rels.push(comment);\r\n      const vmlDrawing = {\r\n        Id: nextRid(rels),\r\n        Type: RelType.VmlDrawing,\r\n        Target: `../drawings/vmlDrawing${model.id}.vml`,\r\n      };\r\n      rels.push(vmlDrawing);\r\n\r\n      model.comments.forEach(item => {\r\n        item.refAddress = colCache.decodeAddress(item.ref);\r\n      });\r\n\r\n      options.commentRefs.push({\r\n        commentName: `comments${model.id}`,\r\n        vmlDrawing: `vmlDrawing${model.id}`,\r\n      });\r\n    }\r\n\r\n    const drawingRelsHash = [];\r\n    let bookImage;\r\n    model.media.forEach(medium => {\r\n      if (medium.type === 'background') {\r\n        const rId = nextRid(rels);\r\n        bookImage = options.media[medium.imageId];\r\n        rels.push({\r\n          Id: rId,\r\n          Type: RelType.Image,\r\n          Target: `../media/${bookImage.name}.${bookImage.extension}`,\r\n        });\r\n        model.background = {\r\n          rId,\r\n        };\r\n        model.image = options.media[medium.imageId];\r\n      } else if (medium.type === 'image') {\r\n        let {drawing} = model;\r\n        bookImage = options.media[medium.imageId];\r\n        if (!drawing) {\r\n          drawing = model.drawing = {\r\n            rId: nextRid(rels),\r\n            name: `drawing${++options.drawingsCount}`,\r\n            anchors: [],\r\n            rels: [],\r\n          };\r\n          options.drawings.push(drawing);\r\n          rels.push({\r\n            Id: drawing.rId,\r\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing',\r\n            Target: `../drawings/${drawing.name}.xml`,\r\n          });\r\n        }\r\n        let rIdImage =\r\n          this.preImageId === medium.imageId\r\n            ? drawingRelsHash[medium.imageId]\r\n            : drawingRelsHash[drawing.rels.length];\r\n        if (!rIdImage) {\r\n          rIdImage = nextRid(drawing.rels);\r\n          drawingRelsHash[drawing.rels.length] = rIdImage;\r\n          drawing.rels.push({\r\n            Id: rIdImage,\r\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/image',\r\n            Target: `../media/${bookImage.name}.${bookImage.extension}`,\r\n          });\r\n        }\r\n\r\n        const anchor = {\r\n          picture: {\r\n            rId: rIdImage,\r\n          },\r\n          range: medium.range,\r\n        };\r\n        if (medium.hyperlinks && medium.hyperlinks.hyperlink) {\r\n          const rIdHyperLink = nextRid(drawing.rels);\r\n          drawingRelsHash[drawing.rels.length] = rIdHyperLink;\r\n          anchor.picture.hyperlinks = {\r\n            tooltip: medium.hyperlinks.tooltip,\r\n            rId: rIdHyperLink,\r\n          };\r\n          drawing.rels.push({\r\n            Id: rIdHyperLink,\r\n            Type: RelType.Hyperlink,\r\n            Target: medium.hyperlinks.hyperlink,\r\n            TargetMode: 'External',\r\n          });\r\n        }\r\n        this.preImageId = medium.imageId;\r\n        drawing.anchors.push(anchor);\r\n      }\r\n    });\r\n\r\n    // prepare tables\r\n    model.tables.forEach(table => {\r\n      // relationships\r\n      const rId = nextRid(rels);\r\n      table.rId = rId;\r\n      rels.push({\r\n        Id: rId,\r\n        Type: RelType.Table,\r\n        Target: `../tables/${table.target}`,\r\n      });\r\n\r\n      // dynamic styles\r\n      table.columns.forEach(column => {\r\n        const {style} = column;\r\n        if (style) {\r\n          column.dxfId = options.styles.addDxfStyle(style);\r\n        }\r\n      });\r\n    });\r\n\r\n    // prepare ext items\r\n    this.map.extLst.prepare(model, options);\r\n  }\r\n\r\n  render(xmlStream, model) {\r\n    xmlStream.openXml(XmlStream.StdDocAttributes);\r\n    xmlStream.openNode('worksheet', WorkSheetXform.WORKSHEET_ATTRIBUTES);\r\n\r\n    const sheetFormatPropertiesModel = model.properties\r\n      ? {\r\n          defaultRowHeight: model.properties.defaultRowHeight,\r\n          dyDescent: model.properties.dyDescent,\r\n          outlineLevelCol: model.properties.outlineLevelCol,\r\n          outlineLevelRow: model.properties.outlineLevelRow,\r\n        }\r\n      : undefined;\r\n    if (model.properties && model.properties.defaultColWidth) {\r\n      sheetFormatPropertiesModel.defaultColWidth = model.properties.defaultColWidth;\r\n    }\r\n    const sheetPropertiesModel = {\r\n      outlineProperties: model.properties && model.properties.outlineProperties,\r\n      tabColor: model.properties && model.properties.tabColor,\r\n      pageSetup:\r\n        model.pageSetup && model.pageSetup.fitToPage\r\n          ? {\r\n              fitToPage: model.pageSetup.fitToPage,\r\n            }\r\n          : undefined,\r\n    };\r\n    const pageMarginsModel = model.pageSetup && model.pageSetup.margins;\r\n    const printOptionsModel = {\r\n      showRowColHeaders: model.pageSetup && model.pageSetup.showRowColHeaders,\r\n      showGridLines: model.pageSetup && model.pageSetup.showGridLines,\r\n      horizontalCentered: model.pageSetup && model.pageSetup.horizontalCentered,\r\n      verticalCentered: model.pageSetup && model.pageSetup.verticalCentered,\r\n    };\r\n    const sheetProtectionModel = model.sheetProtection;\r\n\r\n    this.map.sheetPr.render(xmlStream, sheetPropertiesModel);\r\n    this.map.dimension.render(xmlStream, model.dimensions);\r\n    this.map.sheetViews.render(xmlStream, model.views);\r\n    this.map.sheetFormatPr.render(xmlStream, sheetFormatPropertiesModel);\r\n    this.map.cols.render(xmlStream, model.cols);\r\n    this.map.sheetData.render(xmlStream, model.rows);\r\n    this.map.sheetProtection.render(xmlStream, sheetProtectionModel); // Note: must be after sheetData and before autoFilter\r\n    this.map.autoFilter.render(xmlStream, model.autoFilter);\r\n    this.map.mergeCells.render(xmlStream, model.mergeCells);\r\n    this.map.conditionalFormatting.render(xmlStream, model.conditionalFormattings); // Note: must be before dataValidations\r\n    this.map.dataValidations.render(xmlStream, model.dataValidations);\r\n\r\n    // For some reason hyperlinks have to be after the data validations\r\n    this.map.hyperlinks.render(xmlStream, model.hyperlinks);\r\n\r\n    this.map.printOptions.render(xmlStream, printOptionsModel); // Note: must be before pageMargins\r\n    this.map.pageMargins.render(xmlStream, pageMarginsModel);\r\n    this.map.pageSetup.render(xmlStream, model.pageSetup);\r\n    this.map.headerFooter.render(xmlStream, model.headerFooter);\r\n    this.map.rowBreaks.render(xmlStream, model.rowBreaks);\r\n    this.map.drawing.render(xmlStream, model.drawing); // Note: must be after rowBreaks\r\n    this.map.picture.render(xmlStream, model.background); // Note: must be after drawing\r\n    this.map.tableParts.render(xmlStream, model.tables);\r\n\r\n    this.map.extLst.render(xmlStream, model);\r\n\r\n    if (model.rels) {\r\n      // add a <legacyDrawing /> node for each comment\r\n      model.rels.forEach(rel => {\r\n        if (rel.Type === RelType.VmlDrawing) {\r\n          xmlStream.leafNode('legacyDrawing', {'r:id': rel.Id});\r\n        }\r\n      });\r\n    }\r\n\r\n    xmlStream.closeNode();\r\n  }\r\n\r\n  parseOpen(node) {\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n      return true;\r\n    }\r\n\r\n    if (node.name === 'worksheet') {\r\n      _.each(this.map, xform => {\r\n        xform.reset();\r\n      });\r\n      return true;\r\n    }\r\n\r\n    this.parser = this.map[node.name];\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  parseText(text) {\r\n    if (this.parser) {\r\n      this.parser.parseText(text);\r\n    }\r\n  }\r\n\r\n  parseClose(name) {\r\n    if (this.parser) {\r\n      if (!this.parser.parseClose(name)) {\r\n        this.parser = undefined;\r\n      }\r\n      return true;\r\n    }\r\n    switch (name) {\r\n      case 'worksheet': {\r\n        const properties = this.map.sheetFormatPr.model || {};\r\n        if (this.map.sheetPr.model && this.map.sheetPr.model.tabColor) {\r\n          properties.tabColor = this.map.sheetPr.model.tabColor;\r\n        }\r\n        if (this.map.sheetPr.model && this.map.sheetPr.model.outlineProperties) {\r\n          properties.outlineProperties = this.map.sheetPr.model.outlineProperties;\r\n        }\r\n        const sheetProperties = {\r\n          fitToPage:\r\n            (this.map.sheetPr.model &&\r\n              this.map.sheetPr.model.pageSetup &&\r\n              this.map.sheetPr.model.pageSetup.fitToPage) ||\r\n            false,\r\n          margins: this.map.pageMargins.model,\r\n        };\r\n        const pageSetup = Object.assign(\r\n          sheetProperties,\r\n          this.map.pageSetup.model,\r\n          this.map.printOptions.model\r\n        );\r\n        const conditionalFormattings = mergeConditionalFormattings(\r\n          this.map.conditionalFormatting.model,\r\n          this.map.extLst.model && this.map.extLst.model['x14:conditionalFormattings']\r\n        );\r\n        this.model = {\r\n          dimensions: this.map.dimension.model,\r\n          cols: this.map.cols.model,\r\n          rows: this.map.sheetData.model,\r\n          mergeCells: this.map.mergeCells.model,\r\n          hyperlinks: this.map.hyperlinks.model,\r\n          dataValidations: this.map.dataValidations.model,\r\n          properties,\r\n          views: this.map.sheetViews.model,\r\n          pageSetup,\r\n          headerFooter: this.map.headerFooter.model,\r\n          background: this.map.picture.model,\r\n          drawing: this.map.drawing.model,\r\n          tables: this.map.tableParts.model,\r\n          conditionalFormattings,\r\n        };\r\n\r\n        if (this.map.autoFilter.model) {\r\n          this.model.autoFilter = this.map.autoFilter.model;\r\n        }\r\n        if (this.map.sheetProtection.model) {\r\n          this.model.sheetProtection = this.map.sheetProtection.model;\r\n        }\r\n\r\n        return false;\r\n      }\r\n\r\n      default:\r\n        // not quite sure how we get here!\r\n        return true;\r\n    }\r\n  }\r\n\r\n  reconcile(model, options) {\r\n    // options.merges = new Merges();\r\n    // options.merges.reconcile(model.mergeCells, model.rows);\r\n    const rels = (model.relationships || []).reduce((h, rel) => {\r\n      h[rel.Id] = rel;\r\n      if (rel.Type === RelType.Comments) {\r\n        model.comments = options.comments[rel.Target].comments;\r\n      }\r\n      if (rel.Type === RelType.VmlDrawing && model.comments && model.comments.length) {\r\n        const vmlComment = options.vmlDrawings[rel.Target].comments;\r\n        model.comments.forEach((comment, index) => {\r\n          comment.note = Object.assign({}, comment.note, vmlComment[index]);\r\n        });\r\n      }\r\n      return h;\r\n    }, {});\r\n    options.commentsMap = (model.comments || []).reduce((h, comment) => {\r\n      if (comment.ref) {\r\n        h[comment.ref] = comment;\r\n      }\r\n      return h;\r\n    }, {});\r\n    options.hyperlinkMap = (model.hyperlinks || []).reduce((h, hyperlink) => {\r\n      if (hyperlink.rId) {\r\n        h[hyperlink.address] = rels[hyperlink.rId].Target;\r\n      }\r\n      return h;\r\n    }, {});\r\n    options.formulae = {};\r\n\r\n    // compact the rows and cells\r\n    model.rows = (model.rows && model.rows.filter(Boolean)) || [];\r\n    model.rows.forEach(row => {\r\n      row.cells = (row.cells && row.cells.filter(Boolean)) || [];\r\n    });\r\n\r\n    this.map.cols.reconcile(model.cols, options);\r\n    this.map.sheetData.reconcile(model.rows, options);\r\n    this.map.conditionalFormatting.reconcile(model.conditionalFormattings, options);\r\n\r\n    model.media = [];\r\n    if (model.drawing) {\r\n      const drawingRel = rels[model.drawing.rId];\r\n      const match = drawingRel.Target.match(/\\/drawings\\/([a-zA-Z0-9]+)[.][a-zA-Z]{3,4}$/);\r\n      if (match) {\r\n        const drawingName = match[1];\r\n        const drawing = options.drawings[drawingName];\r\n        drawing.anchors.forEach(anchor => {\r\n          if (anchor.medium) {\r\n            const image = {\r\n              type: 'image',\r\n              imageId: anchor.medium.index,\r\n              range: anchor.range,\r\n              hyperlinks: anchor.picture.hyperlinks,\r\n            };\r\n            model.media.push(image);\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    const backgroundRel = model.background && rels[model.background.rId];\r\n    if (backgroundRel) {\r\n      const target = backgroundRel.Target.split('/media/')[1];\r\n      const imageId = options.mediaIndex && options.mediaIndex[target];\r\n      if (imageId !== undefined) {\r\n        model.media.push({\r\n          type: 'background',\r\n          imageId,\r\n        });\r\n      }\r\n    }\r\n\r\n    model.tables = (model.tables || []).map(tablePart => {\r\n      const rel = rels[tablePart.rId];\r\n      return options.tables[rel.Target];\r\n    });\r\n\r\n    delete model.relationships;\r\n    delete model.hyperlinks;\r\n    delete model.comments;\r\n  }\r\n}\r\n\r\nWorkSheetXform.WORKSHEET_ATTRIBUTES = {\r\n  xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\r\n  'xmlns:r': 'http://schemas.openxmlformats.org/officeDocument/2006/relationships',\r\n  'xmlns:mc': 'http://schemas.openxmlformats.org/markup-compatibility/2006',\r\n  'mc:Ignorable': 'x14ac',\r\n  'xmlns:x14ac': 'http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac',\r\n};\r\n\r\nmodule.exports = WorkSheetXform;\r\n"],"file":"worksheet-xform.js"}
=======
{"version":3,"file":"worksheet-xform.js","names":["_","require","colCache","XmlStream","RelType","Merges","BaseXform","ListXform","RowXform","ColXform","DimensionXform","HyperlinkXform","MergeCellXform","DataValidationsXform","SheetPropertiesXform","SheetFormatPropertiesXform","SheetViewXform","SheetProtectionXform","PageMarginsXform","PageSetupXform","PrintOptionsXform","AutoFilterXform","PictureXform","DrawingXform","TablePartXform","RowBreaksXform","HeaderFooterXform","ConditionalFormattingsXform","ExtListXform","mergeRule","rule","extRule","Object","keys","forEach","key","value","extValue","undefined","mergeConditionalFormattings","model","extModel","length","cfMap","ruleMap","cf","ref","rules","x14Id","extCf","push","WorkSheetXform","constructor","options","maxRows","maxCols","ignoreNodes","map","sheetPr","dimension","sheetViews","tag","count","childXform","sheetFormatPr","cols","sheetData","empty","maxItems","autoFilter","mergeCells","rowBreaks","hyperlinks","pageMargins","dataValidations","pageSetup","headerFooter","printOptions","picture","drawing","sheetProtection","tableParts","conditionalFormatting","extLst","prepare","merges","comments","formulae","siFormulae","rows","conditionalFormattings","rels","nextRid","r","hyperlink","rId","Id","Type","Hyperlink","Target","target","TargetMode","comment","Comments","id","vmlDrawing","VmlDrawing","item","refAddress","decodeAddress","commentRefs","commentName","drawingRelsHash","bookImage","media","medium","type","imageId","Image","name","extension","background","image","drawingsCount","anchors","drawings","rIdImage","preImageId","anchor","range","rIdHyperLink","tooltip","tables","table","Table","columns","column","style","dxfId","styles","addDxfStyle","render","xmlStream","openXml","StdDocAttributes","openNode","WORKSHEET_ATTRIBUTES","sheetFormatPropertiesModel","properties","defaultRowHeight","dyDescent","outlineLevelCol","outlineLevelRow","defaultColWidth","sheetPropertiesModel","outlineProperties","tabColor","fitToPage","pageMarginsModel","margins","printOptionsModel","showRowColHeaders","showGridLines","horizontalCentered","verticalCentered","sheetProtectionModel","dimensions","views","rel","leafNode","closeNode","parseOpen","node","parser","each","xform","reset","includes","parseText","text","parseClose","sheetProperties","assign","reconcile","relationships","reduce","h","vmlComment","vmlDrawings","index","note","commentsMap","hyperlinkMap","address","filter","Boolean","row","cells","drawingRel","match","drawingName","backgroundRel","split","mediaIndex","tablePart","xmlns","module","exports"],"sources":["../../../../../lib/xlsx/xform/sheet/worksheet-xform.js"],"sourcesContent":["const _ = require('../../../utils/under-dash');\n\nconst colCache = require('../../../utils/col-cache');\nconst XmlStream = require('../../../utils/xml-stream');\n\nconst RelType = require('../../rel-type');\n\nconst Merges = require('./merges');\n\nconst BaseXform = require('../base-xform');\nconst ListXform = require('../list-xform');\nconst RowXform = require('./row-xform');\nconst ColXform = require('./col-xform');\nconst DimensionXform = require('./dimension-xform');\nconst HyperlinkXform = require('./hyperlink-xform');\nconst MergeCellXform = require('./merge-cell-xform');\nconst DataValidationsXform = require('./data-validations-xform');\nconst SheetPropertiesXform = require('./sheet-properties-xform');\nconst SheetFormatPropertiesXform = require('./sheet-format-properties-xform');\nconst SheetViewXform = require('./sheet-view-xform');\nconst SheetProtectionXform = require('./sheet-protection-xform');\nconst PageMarginsXform = require('./page-margins-xform');\nconst PageSetupXform = require('./page-setup-xform');\nconst PrintOptionsXform = require('./print-options-xform');\nconst AutoFilterXform = require('./auto-filter-xform');\nconst PictureXform = require('./picture-xform');\nconst DrawingXform = require('./drawing-xform');\nconst TablePartXform = require('./table-part-xform');\nconst RowBreaksXform = require('./row-breaks-xform');\nconst HeaderFooterXform = require('./header-footer-xform');\nconst ConditionalFormattingsXform = require('./cf/conditional-formattings-xform');\nconst ExtListXform = require('./ext-lst-xform');\n\nconst mergeRule = (rule, extRule) => {\n  Object.keys(extRule).forEach(key => {\n    const value = rule[key];\n    const extValue = extRule[key];\n    if (value === undefined && extValue !== undefined) {\n      rule[key] = extValue;\n    }\n  });\n};\n\nconst mergeConditionalFormattings = (model, extModel) => {\n  // conditional formattings are rendered in worksheet.conditionalFormatting and also in\n  // worksheet.extLst.ext.x14:conditionalFormattings\n  // some (e.g. dataBar) are even spread across both!\n  if (!extModel || !extModel.length) {\n    return model;\n  }\n  if (!model || !model.length) {\n    return extModel;\n  }\n\n  // index model rules by x14Id\n  const cfMap = {};\n  const ruleMap = {};\n  model.forEach(cf => {\n    cfMap[cf.ref] = cf;\n    cf.rules.forEach(rule => {\n      const {x14Id} = rule;\n      if (x14Id) {\n        ruleMap[x14Id] = rule;\n      }\n    });\n  });\n\n  extModel.forEach(extCf => {\n    extCf.rules.forEach(extRule => {\n      const rule = ruleMap[extRule.x14Id];\n      if (rule) {\n        // merge with matching rule\n        mergeRule(rule, extRule);\n      } else if (cfMap[extCf.ref]) {\n        // reuse existing cf ref\n        cfMap[extCf.ref].rules.push(extRule);\n      } else {\n        // create new cf\n        model.push({\n          ref: extCf.ref,\n          rules: [extRule],\n        });\n      }\n    });\n  });\n\n  // need to cope with rules in extModel that don't exist in model\n  return model;\n};\n\nclass WorkSheetXform extends BaseXform {\n  constructor(options) {\n    super();\n\n    const {maxRows, maxCols, ignoreNodes} = options || {};\n\n    this.ignoreNodes = ignoreNodes || [];\n\n    this.map = {\n      sheetPr: new SheetPropertiesXform(),\n      dimension: new DimensionXform(),\n      sheetViews: new ListXform({\n        tag: 'sheetViews',\n        count: false,\n        childXform: new SheetViewXform(),\n      }),\n      sheetFormatPr: new SheetFormatPropertiesXform(),\n      cols: new ListXform({tag: 'cols', count: false, childXform: new ColXform()}),\n      sheetData: new ListXform({\n        tag: 'sheetData',\n        count: false,\n        empty: true,\n        childXform: new RowXform({maxItems: maxCols}),\n        maxItems: maxRows,\n      }),\n      autoFilter: new AutoFilterXform(),\n      mergeCells: new ListXform({tag: 'mergeCells', count: true, childXform: new MergeCellXform()}),\n      rowBreaks: new RowBreaksXform(),\n      hyperlinks: new ListXform({\n        tag: 'hyperlinks',\n        count: false,\n        childXform: new HyperlinkXform(),\n      }),\n      pageMargins: new PageMarginsXform(),\n      dataValidations: new DataValidationsXform(),\n      pageSetup: new PageSetupXform(),\n      headerFooter: new HeaderFooterXform(),\n      printOptions: new PrintOptionsXform(),\n      picture: new PictureXform(),\n      drawing: new DrawingXform(),\n      sheetProtection: new SheetProtectionXform(),\n      tableParts: new ListXform({tag: 'tableParts', count: true, childXform: new TablePartXform()}),\n      conditionalFormatting: new ConditionalFormattingsXform(),\n      extLst: new ExtListXform(),\n    };\n  }\n\n  prepare(model, options) {\n    options.merges = new Merges();\n    model.hyperlinks = options.hyperlinks = [];\n    model.comments = options.comments = [];\n\n    options.formulae = {};\n    options.siFormulae = 0;\n    this.map.cols.prepare(model.cols, options);\n    this.map.sheetData.prepare(model.rows, options);\n    this.map.conditionalFormatting.prepare(model.conditionalFormattings, options);\n\n    model.mergeCells = options.merges.mergeCells;\n\n    // prepare relationships\n    const rels = (model.rels = []);\n\n    function nextRid(r) {\n      return `rId${r.length + 1}`;\n    }\n\n    model.hyperlinks.forEach(hyperlink => {\n      const rId = nextRid(rels);\n      hyperlink.rId = rId;\n      rels.push({\n        Id: rId,\n        Type: RelType.Hyperlink,\n        Target: hyperlink.target,\n        TargetMode: 'External',\n      });\n    });\n\n    // prepare comment relationships\n    if (model.comments.length > 0) {\n      const comment = {\n        Id: nextRid(rels),\n        Type: RelType.Comments,\n        Target: `../comments${model.id}.xml`,\n      };\n      rels.push(comment);\n      const vmlDrawing = {\n        Id: nextRid(rels),\n        Type: RelType.VmlDrawing,\n        Target: `../drawings/vmlDrawing${model.id}.vml`,\n      };\n      rels.push(vmlDrawing);\n\n      model.comments.forEach(item => {\n        item.refAddress = colCache.decodeAddress(item.ref);\n      });\n\n      options.commentRefs.push({\n        commentName: `comments${model.id}`,\n        vmlDrawing: `vmlDrawing${model.id}`,\n      });\n    }\n\n    const drawingRelsHash = [];\n    let bookImage;\n    model.media.forEach(medium => {\n      if (medium.type === 'background') {\n        const rId = nextRid(rels);\n        bookImage = options.media[medium.imageId];\n        rels.push({\n          Id: rId,\n          Type: RelType.Image,\n          Target: `../media/${bookImage.name}.${bookImage.extension}`,\n        });\n        model.background = {\n          rId,\n        };\n        model.image = options.media[medium.imageId];\n      } else if (medium.type === 'image') {\n        let {drawing} = model;\n        bookImage = options.media[medium.imageId];\n        if (!drawing) {\n          drawing = model.drawing = {\n            rId: nextRid(rels),\n            name: `drawing${++options.drawingsCount}`,\n            anchors: [],\n            rels: [],\n          };\n          options.drawings.push(drawing);\n          rels.push({\n            Id: drawing.rId,\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing',\n            Target: `../drawings/${drawing.name}.xml`,\n          });\n        }\n        let rIdImage =\n          this.preImageId === medium.imageId ? drawingRelsHash[medium.imageId] : drawingRelsHash[drawing.rels.length];\n        if (!rIdImage) {\n          rIdImage = nextRid(drawing.rels);\n          drawingRelsHash[drawing.rels.length] = rIdImage;\n          drawing.rels.push({\n            Id: rIdImage,\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/image',\n            Target: `../media/${bookImage.name}.${bookImage.extension}`,\n          });\n        }\n\n        const anchor = {\n          picture: {\n            rId: rIdImage,\n          },\n          range: medium.range,\n        };\n        if (medium.hyperlinks && medium.hyperlinks.hyperlink) {\n          const rIdHyperLink = nextRid(drawing.rels);\n          drawingRelsHash[drawing.rels.length] = rIdHyperLink;\n          anchor.picture.hyperlinks = {\n            tooltip: medium.hyperlinks.tooltip,\n            rId: rIdHyperLink,\n          };\n          drawing.rels.push({\n            Id: rIdHyperLink,\n            Type: RelType.Hyperlink,\n            Target: medium.hyperlinks.hyperlink,\n            TargetMode: 'External',\n          });\n        }\n        this.preImageId = medium.imageId;\n        drawing.anchors.push(anchor);\n      }\n    });\n\n    // prepare tables\n    model.tables.forEach(table => {\n      // relationships\n      const rId = nextRid(rels);\n      table.rId = rId;\n      rels.push({\n        Id: rId,\n        Type: RelType.Table,\n        Target: `../tables/${table.target}`,\n      });\n\n      // dynamic styles\n      table.columns.forEach(column => {\n        const {style} = column;\n        if (style) {\n          column.dxfId = options.styles.addDxfStyle(style);\n        }\n      });\n    });\n\n    // prepare ext items\n    this.map.extLst.prepare(model, options);\n  }\n\n  render(xmlStream, model) {\n    xmlStream.openXml(XmlStream.StdDocAttributes);\n    xmlStream.openNode('worksheet', WorkSheetXform.WORKSHEET_ATTRIBUTES);\n\n    const sheetFormatPropertiesModel = model.properties\n      ? {\n          defaultRowHeight: model.properties.defaultRowHeight,\n          dyDescent: model.properties.dyDescent,\n          outlineLevelCol: model.properties.outlineLevelCol,\n          outlineLevelRow: model.properties.outlineLevelRow,\n        }\n      : undefined;\n    if (model.properties && model.properties.defaultColWidth) {\n      sheetFormatPropertiesModel.defaultColWidth = model.properties.defaultColWidth;\n    }\n    const sheetPropertiesModel = {\n      outlineProperties: model.properties && model.properties.outlineProperties,\n      tabColor: model.properties && model.properties.tabColor,\n      pageSetup:\n        model.pageSetup && model.pageSetup.fitToPage\n          ? {\n              fitToPage: model.pageSetup.fitToPage,\n            }\n          : undefined,\n    };\n    const pageMarginsModel = model.pageSetup && model.pageSetup.margins;\n    const printOptionsModel = {\n      showRowColHeaders: model.pageSetup && model.pageSetup.showRowColHeaders,\n      showGridLines: model.pageSetup && model.pageSetup.showGridLines,\n      horizontalCentered: model.pageSetup && model.pageSetup.horizontalCentered,\n      verticalCentered: model.pageSetup && model.pageSetup.verticalCentered,\n    };\n    const sheetProtectionModel = model.sheetProtection;\n\n    this.map.sheetPr.render(xmlStream, sheetPropertiesModel);\n    this.map.dimension.render(xmlStream, model.dimensions);\n    this.map.sheetViews.render(xmlStream, model.views);\n    this.map.sheetFormatPr.render(xmlStream, sheetFormatPropertiesModel);\n    this.map.cols.render(xmlStream, model.cols);\n    this.map.sheetData.render(xmlStream, model.rows);\n    this.map.sheetProtection.render(xmlStream, sheetProtectionModel); // Note: must be after sheetData and before autoFilter\n    this.map.autoFilter.render(xmlStream, model.autoFilter);\n    this.map.mergeCells.render(xmlStream, model.mergeCells);\n    this.map.conditionalFormatting.render(xmlStream, model.conditionalFormattings); // Note: must be before dataValidations\n    this.map.dataValidations.render(xmlStream, model.dataValidations);\n\n    // For some reason hyperlinks have to be after the data validations\n    this.map.hyperlinks.render(xmlStream, model.hyperlinks);\n\n    this.map.printOptions.render(xmlStream, printOptionsModel); // Note: must be before pageMargins\n    this.map.pageMargins.render(xmlStream, pageMarginsModel);\n    this.map.pageSetup.render(xmlStream, model.pageSetup);\n    this.map.headerFooter.render(xmlStream, model.headerFooter);\n    this.map.rowBreaks.render(xmlStream, model.rowBreaks);\n    this.map.drawing.render(xmlStream, model.drawing); // Note: must be after rowBreaks\n    this.map.picture.render(xmlStream, model.background); // Note: must be after drawing\n    this.map.tableParts.render(xmlStream, model.tables);\n\n    this.map.extLst.render(xmlStream, model);\n\n    if (model.rels) {\n      // add a <legacyDrawing /> node for each comment\n      model.rels.forEach(rel => {\n        if (rel.Type === RelType.VmlDrawing) {\n          xmlStream.leafNode('legacyDrawing', {'r:id': rel.Id});\n        }\n      });\n    }\n\n    xmlStream.closeNode();\n  }\n\n  parseOpen(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n\n    if (node.name === 'worksheet') {\n      _.each(this.map, xform => {\n        xform.reset();\n      });\n      return true;\n    }\n\n    if (this.map[node.name] && !this.ignoreNodes.includes(node.name)) {\n      this.parser = this.map[node.name];\n      this.parser.parseOpen(node);\n    }\n    return true;\n  }\n\n  parseText(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  }\n\n  parseClose(name) {\n    if (this.parser) {\n      if (!this.parser.parseClose(name)) {\n        this.parser = undefined;\n      }\n      return true;\n    }\n    switch (name) {\n      case 'worksheet': {\n        const properties = this.map.sheetFormatPr.model || {};\n        if (this.map.sheetPr.model && this.map.sheetPr.model.tabColor) {\n          properties.tabColor = this.map.sheetPr.model.tabColor;\n        }\n        if (this.map.sheetPr.model && this.map.sheetPr.model.outlineProperties) {\n          properties.outlineProperties = this.map.sheetPr.model.outlineProperties;\n        }\n        const sheetProperties = {\n          fitToPage:\n            (this.map.sheetPr.model &&\n              this.map.sheetPr.model.pageSetup &&\n              this.map.sheetPr.model.pageSetup.fitToPage) ||\n            false,\n          margins: this.map.pageMargins.model,\n        };\n        const pageSetup = Object.assign(sheetProperties, this.map.pageSetup.model, this.map.printOptions.model);\n        const conditionalFormattings = mergeConditionalFormattings(\n          this.map.conditionalFormatting.model,\n          this.map.extLst.model && this.map.extLst.model['x14:conditionalFormattings']\n        );\n        this.model = {\n          dimensions: this.map.dimension.model,\n          cols: this.map.cols.model,\n          rows: this.map.sheetData.model,\n          mergeCells: this.map.mergeCells.model,\n          hyperlinks: this.map.hyperlinks.model,\n          dataValidations: this.map.dataValidations.model,\n          properties,\n          views: this.map.sheetViews.model,\n          pageSetup,\n          headerFooter: this.map.headerFooter.model,\n          background: this.map.picture.model,\n          drawing: this.map.drawing.model,\n          tables: this.map.tableParts.model,\n          conditionalFormattings,\n        };\n\n        if (this.map.autoFilter.model) {\n          this.model.autoFilter = this.map.autoFilter.model;\n        }\n        if (this.map.sheetProtection.model) {\n          this.model.sheetProtection = this.map.sheetProtection.model;\n        }\n\n        return false;\n      }\n\n      default:\n        // not quite sure how we get here!\n        return true;\n    }\n  }\n\n  reconcile(model, options) {\n    // options.merges = new Merges();\n    // options.merges.reconcile(model.mergeCells, model.rows);\n    const rels = (model.relationships || []).reduce((h, rel) => {\n      h[rel.Id] = rel;\n      if (rel.Type === RelType.Comments) {\n        model.comments = options.comments[rel.Target].comments;\n      }\n      if (rel.Type === RelType.VmlDrawing && model.comments && model.comments.length) {\n        const vmlComment = options.vmlDrawings[rel.Target].comments;\n        model.comments.forEach((comment, index) => {\n          comment.note = Object.assign({}, comment.note, vmlComment[index]);\n        });\n      }\n      return h;\n    }, {});\n    options.commentsMap = (model.comments || []).reduce((h, comment) => {\n      if (comment.ref) {\n        h[comment.ref] = comment;\n      }\n      return h;\n    }, {});\n    options.hyperlinkMap = (model.hyperlinks || []).reduce((h, hyperlink) => {\n      if (hyperlink.rId) {\n        h[hyperlink.address] = rels[hyperlink.rId].Target;\n      }\n      return h;\n    }, {});\n    options.formulae = {};\n\n    // compact the rows and cells\n    model.rows = (model.rows && model.rows.filter(Boolean)) || [];\n    model.rows.forEach(row => {\n      row.cells = (row.cells && row.cells.filter(Boolean)) || [];\n    });\n\n    this.map.cols.reconcile(model.cols, options);\n    this.map.sheetData.reconcile(model.rows, options);\n    this.map.conditionalFormatting.reconcile(model.conditionalFormattings, options);\n\n    model.media = [];\n    if (model.drawing) {\n      const drawingRel = rels[model.drawing.rId];\n      const match = drawingRel.Target.match(/\\/drawings\\/([a-zA-Z0-9]+)[.][a-zA-Z]{3,4}$/);\n      if (match) {\n        const drawingName = match[1];\n        const drawing = options.drawings[drawingName];\n        drawing.anchors.forEach(anchor => {\n          if (anchor.medium) {\n            const image = {\n              type: 'image',\n              imageId: anchor.medium.index,\n              range: anchor.range,\n              hyperlinks: anchor.picture.hyperlinks,\n            };\n            model.media.push(image);\n          }\n        });\n      }\n    }\n\n    const backgroundRel = model.background && rels[model.background.rId];\n    if (backgroundRel) {\n      const target = backgroundRel.Target.split('/media/')[1];\n      const imageId = options.mediaIndex && options.mediaIndex[target];\n      if (imageId !== undefined) {\n        model.media.push({\n          type: 'background',\n          imageId,\n        });\n      }\n    }\n\n    model.tables = (model.tables || []).map(tablePart => {\n      const rel = rels[tablePart.rId];\n      return options.tables[rel.Target];\n    });\n\n    delete model.relationships;\n    delete model.hyperlinks;\n    delete model.comments;\n  }\n}\n\nWorkSheetXform.WORKSHEET_ATTRIBUTES = {\n  xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\n  'xmlns:r': 'http://schemas.openxmlformats.org/officeDocument/2006/relationships',\n  'xmlns:mc': 'http://schemas.openxmlformats.org/markup-compatibility/2006',\n  'mc:Ignorable': 'x14ac',\n  'xmlns:x14ac': 'http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac',\n};\n\nmodule.exports = WorkSheetXform;\n"],"mappings":"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"}
>>>>>>> 95bdce0e2476f31a1a1d26b5d1f458cd5295e48d
