<<<<<<< HEAD
{"version":3,"sources":["../../../../../lib/xlsx/xform/sheet/data-validations-xform.js"],"names":["_","require","utils","colCache","BaseXform","Range","assign","definedName","attributes","name","defaultValue","value","undefined","parseBool","assignBool","optimiseDataValidations","model","dvList","map","dataValidation","address","marked","sort","a","b","strcmp","dvMap","keyBy","matchCol","addr","height","col","i","otherAddress","encodeAddress","row","isEqual","dv","decodeEx","dimensions","sqref","width","j","bottom","right","filter","Boolean","DataValidationsXform","xmlStream","optimizedModel","length","openNode","count","forEach","type","addAttribute","operator","allowBlank","showInputMessage","promptTitle","prompt","showErrorMessage","errorStyle","errorTitle","error","formulae","formula","index","writeText","dateToExcel","Date","closeNode","node","_address","_dataValidation","_formula","text","push","list","split","includes","range","forEachAddress","join","parseInt","parseFloat","excelToDate","module","exports"],"mappings":"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","sourcesContent":["const _ = require('../../../utils/under-dash');\r\nconst utils = require('../../../utils/utils');\r\nconst colCache = require('../../../utils/col-cache');\r\nconst BaseXform = require('../base-xform');\r\nconst Range = require('../../../doc/range');\r\n\r\nfunction assign(definedName, attributes, name, defaultValue) {\r\n  const value = attributes[name];\r\n  if (value !== undefined) {\r\n    definedName[name] = value;\r\n  } else if (defaultValue !== undefined) {\r\n    definedName[name] = defaultValue;\r\n  }\r\n}\r\nfunction parseBool(value) {\r\n  switch (value) {\r\n    case '1':\r\n    case 'true':\r\n      return true;\r\n    default:\r\n      return false;\r\n  }\r\n}\r\nfunction assignBool(definedName, attributes, name, defaultValue) {\r\n  const value = attributes[name];\r\n  if (value !== undefined) {\r\n    definedName[name] = parseBool(value);\r\n  } else if (defaultValue !== undefined) {\r\n    definedName[name] = defaultValue;\r\n  }\r\n}\r\n\r\nfunction optimiseDataValidations(model) {\r\n  // Squeeze alike data validations together into rectangular ranges\r\n  // to reduce file size and speed up Excel load time\r\n  const dvList = _.map(model, (dataValidation, address) => ({\r\n    address,\r\n    dataValidation,\r\n    marked: false,\r\n  })).sort((a, b) => _.strcmp(a.address, b.address));\r\n  const dvMap = _.keyBy(dvList, 'address');\r\n  const matchCol = (addr, height, col) => {\r\n    for (let i = 0; i < height; i++) {\r\n      const otherAddress = colCache.encodeAddress(addr.row + i, col);\r\n      if (!model[otherAddress] || !_.isEqual(model[addr.address], model[otherAddress])) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  };\r\n  return dvList\r\n    .map(dv => {\r\n      if (!dv.marked) {\r\n        const addr = colCache.decodeEx(dv.address);\r\n        if (addr.dimensions) {\r\n          dvMap[addr.dimensions].marked = true;\r\n          return {\r\n            ...dv.dataValidation,\r\n            sqref: dv.address,\r\n          };\r\n        }\r\n\r\n        // iterate downwards - finding matching cells\r\n        let height = 1;\r\n        let otherAddress = colCache.encodeAddress(addr.row + height, addr.col);\r\n        while (model[otherAddress] && _.isEqual(dv.dataValidation, model[otherAddress])) {\r\n          height++;\r\n          otherAddress = colCache.encodeAddress(addr.row + height, addr.col);\r\n        }\r\n\r\n        // iterate rightwards...\r\n\r\n        let width = 1;\r\n        while (matchCol(addr, height, addr.col + width)) {\r\n          width++;\r\n        }\r\n\r\n        // mark all included addresses\r\n        for (let i = 0; i < height; i++) {\r\n          for (let j = 0; j < width; j++) {\r\n            otherAddress = colCache.encodeAddress(addr.row + i, addr.col + j);\r\n            dvMap[otherAddress].marked = true;\r\n          }\r\n        }\r\n\r\n        if (height > 1 || width > 1) {\r\n          const bottom = addr.row + (height - 1);\r\n          const right = addr.col + (width - 1);\r\n          return {\r\n            ...dv.dataValidation,\r\n            sqref: `${dv.address}:${colCache.encodeAddress(bottom, right)}`,\r\n          };\r\n        }\r\n        return {\r\n          ...dv.dataValidation,\r\n          sqref: dv.address,\r\n        };\r\n      }\r\n      return null;\r\n    })\r\n    .filter(Boolean);\r\n}\r\n\r\nclass DataValidationsXform extends BaseXform {\r\n  get tag() {\r\n    return 'dataValidations';\r\n  }\r\n\r\n  render(xmlStream, model) {\r\n    const optimizedModel = optimiseDataValidations(model);\r\n    if (optimizedModel.length) {\r\n      xmlStream.openNode('dataValidations', {count: optimizedModel.length});\r\n\r\n      optimizedModel.forEach(value => {\r\n        xmlStream.openNode('dataValidation');\r\n\r\n        if (value.type !== 'any') {\r\n          xmlStream.addAttribute('type', value.type);\r\n\r\n          if (value.operator && value.type !== 'list' && value.operator !== 'between') {\r\n            xmlStream.addAttribute('operator', value.operator);\r\n          }\r\n          if (value.allowBlank) {\r\n            xmlStream.addAttribute('allowBlank', '1');\r\n          }\r\n        }\r\n        if (value.showInputMessage) {\r\n          xmlStream.addAttribute('showInputMessage', '1');\r\n        }\r\n        if (value.promptTitle) {\r\n          xmlStream.addAttribute('promptTitle', value.promptTitle);\r\n        }\r\n        if (value.prompt) {\r\n          xmlStream.addAttribute('prompt', value.prompt);\r\n        }\r\n        if (value.showErrorMessage) {\r\n          xmlStream.addAttribute('showErrorMessage', '1');\r\n        }\r\n        if (value.errorStyle) {\r\n          xmlStream.addAttribute('errorStyle', value.errorStyle);\r\n        }\r\n        if (value.errorTitle) {\r\n          xmlStream.addAttribute('errorTitle', value.errorTitle);\r\n        }\r\n        if (value.error) {\r\n          xmlStream.addAttribute('error', value.error);\r\n        }\r\n        xmlStream.addAttribute('sqref', value.sqref);\r\n        (value.formulae || []).forEach((formula, index) => {\r\n          xmlStream.openNode(`formula${index + 1}`);\r\n          if (value.type === 'date') {\r\n            xmlStream.writeText(utils.dateToExcel(new Date(formula)));\r\n          } else {\r\n            xmlStream.writeText(formula);\r\n          }\r\n          xmlStream.closeNode();\r\n        });\r\n        xmlStream.closeNode();\r\n      });\r\n      xmlStream.closeNode();\r\n    }\r\n  }\r\n\r\n  parseOpen(node) {\r\n    switch (node.name) {\r\n      case 'dataValidations':\r\n        this.model = {};\r\n        return true;\r\n\r\n      case 'dataValidation': {\r\n        this._address = node.attributes.sqref;\r\n        const dataValidation = {type: node.attributes.type || 'any', formulae: []};\r\n\r\n        if (node.attributes.type) {\r\n          assignBool(dataValidation, node.attributes, 'allowBlank');\r\n        }\r\n        assignBool(dataValidation, node.attributes, 'showInputMessage');\r\n        assignBool(dataValidation, node.attributes, 'showErrorMessage');\r\n\r\n        switch (dataValidation.type) {\r\n          case 'any':\r\n          case 'list':\r\n          case 'custom':\r\n            break;\r\n          default:\r\n            assign(dataValidation, node.attributes, 'operator', 'between');\r\n            break;\r\n        }\r\n        assign(dataValidation, node.attributes, 'promptTitle');\r\n        assign(dataValidation, node.attributes, 'prompt');\r\n        assign(dataValidation, node.attributes, 'errorStyle');\r\n        assign(dataValidation, node.attributes, 'errorTitle');\r\n        assign(dataValidation, node.attributes, 'error');\r\n\r\n        this._dataValidation = dataValidation;\r\n        return true;\r\n      }\r\n\r\n      case 'formula1':\r\n      case 'formula2':\r\n        this._formula = [];\r\n        return true;\r\n\r\n      default:\r\n        return false;\r\n    }\r\n  }\r\n\r\n  parseText(text) {\r\n    if (this._formula) {\r\n      this._formula.push(text);\r\n    }\r\n  }\r\n\r\n  parseClose(name) {\r\n    switch (name) {\r\n      case 'dataValidations':\r\n        return false;\r\n      case 'dataValidation': {\r\n        if (!this._dataValidation.formulae || !this._dataValidation.formulae.length) {\r\n          delete this._dataValidation.formulae;\r\n          delete this._dataValidation.operator;\r\n        }\r\n        // The four known cases: 1. E4:L9 N4:U9  2.E4 L9  3. N4:U9  4. E4\r\n        const list = this._address.split(/\\s+/g) || [];\r\n        list.forEach(addr => {\r\n          if (addr.includes(':')) {\r\n            const range = new Range(addr);\r\n            range.forEachAddress(address => {\r\n              this.model[address] = this._dataValidation;\r\n            });\r\n          } else {\r\n            this.model[addr] = this._dataValidation;\r\n          }\r\n        });\r\n        return true;\r\n      }\r\n      case 'formula1':\r\n      case 'formula2': {\r\n        let formula = this._formula.join('');\r\n        switch (this._dataValidation.type) {\r\n          case 'whole':\r\n          case 'textLength':\r\n            formula = parseInt(formula, 10);\r\n            break;\r\n          case 'decimal':\r\n            formula = parseFloat(formula);\r\n            break;\r\n          case 'date':\r\n            formula = utils.excelToDate(parseFloat(formula));\r\n            break;\r\n          default:\r\n            break;\r\n        }\r\n        this._dataValidation.formulae.push(formula);\r\n        this._formula = undefined;\r\n        return true;\r\n      }\r\n      default:\r\n        return true;\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = DataValidationsXform;\r\n"],"file":"data-validations-xform.js"}
=======
{"version":3,"file":"data-validations-xform.js","names":["_","require","utils","colCache","BaseXform","Range","assign","definedName","attributes","name","defaultValue","value","undefined","assignBool","parseBoolean","optimiseDataValidations","model","dvList","map","dataValidation","address","marked","sort","a","b","strcmp","dvMap","keyBy","matchCol","addr","height","col","i","otherAddress","encodeAddress","row","isEqual","dv","decodeEx","dimensions","sqref","width","j","bottom","right","filter","Boolean","DataValidationsXform","tag","render","xmlStream","optimizedModel","length","openNode","count","forEach","type","addAttribute","operator","allowBlank","showInputMessage","promptTitle","prompt","showErrorMessage","errorStyle","errorTitle","error","formulae","formula","index","writeText","dateToExcel","Date","closeNode","parseOpen","node","_address","_dataValidation","_formula","parseText","text","push","parseClose","list","split","includes","range","forEachAddress","join","parseInt","parseFloat","excelToDate","module","exports"],"sources":["../../../../../lib/xlsx/xform/sheet/data-validations-xform.js"],"sourcesContent":["const _ = require('../../../utils/under-dash');\nconst utils = require('../../../utils/utils');\nconst colCache = require('../../../utils/col-cache');\nconst BaseXform = require('../base-xform');\nconst Range = require('../../../doc/range');\n\nfunction assign(definedName, attributes, name, defaultValue) {\n  const value = attributes[name];\n  if (value !== undefined) {\n    definedName[name] = value;\n  } else if (defaultValue !== undefined) {\n    definedName[name] = defaultValue;\n  }\n}\n\nfunction assignBool(definedName, attributes, name, defaultValue) {\n  const value = attributes[name];\n  if (value !== undefined) {\n    definedName[name] = utils.parseBoolean(value);\n  } else if (defaultValue !== undefined) {\n    definedName[name] = defaultValue;\n  }\n}\n\nfunction optimiseDataValidations(model) {\n  // Squeeze alike data validations together into rectangular ranges\n  // to reduce file size and speed up Excel load time\n  const dvList = _.map(model, (dataValidation, address) => ({\n    address,\n    dataValidation,\n    marked: false,\n  })).sort((a, b) => _.strcmp(a.address, b.address));\n  const dvMap = _.keyBy(dvList, 'address');\n  const matchCol = (addr, height, col) => {\n    for (let i = 0; i < height; i++) {\n      const otherAddress = colCache.encodeAddress(addr.row + i, col);\n      if (!model[otherAddress] || !_.isEqual(model[addr.address], model[otherAddress])) {\n        return false;\n      }\n    }\n    return true;\n  };\n  return dvList\n    .map(dv => {\n      if (!dv.marked) {\n        const addr = colCache.decodeEx(dv.address);\n        if (addr.dimensions) {\n          dvMap[addr.dimensions].marked = true;\n          return {\n            ...dv.dataValidation,\n            sqref: dv.address,\n          };\n        }\n\n        // iterate downwards - finding matching cells\n        let height = 1;\n        let otherAddress = colCache.encodeAddress(addr.row + height, addr.col);\n        while (model[otherAddress] && _.isEqual(dv.dataValidation, model[otherAddress])) {\n          height++;\n          otherAddress = colCache.encodeAddress(addr.row + height, addr.col);\n        }\n\n        // iterate rightwards...\n\n        let width = 1;\n        while (matchCol(addr, height, addr.col + width)) {\n          width++;\n        }\n\n        // mark all included addresses\n        for (let i = 0; i < height; i++) {\n          for (let j = 0; j < width; j++) {\n            otherAddress = colCache.encodeAddress(addr.row + i, addr.col + j);\n            dvMap[otherAddress].marked = true;\n          }\n        }\n\n        if (height > 1 || width > 1) {\n          const bottom = addr.row + (height - 1);\n          const right = addr.col + (width - 1);\n          return {\n            ...dv.dataValidation,\n            sqref: `${dv.address}:${colCache.encodeAddress(bottom, right)}`,\n          };\n        }\n        return {\n          ...dv.dataValidation,\n          sqref: dv.address,\n        };\n      }\n      return null;\n    })\n    .filter(Boolean);\n}\n\nclass DataValidationsXform extends BaseXform {\n  get tag() {\n    return 'dataValidations';\n  }\n\n  render(xmlStream, model) {\n    const optimizedModel = optimiseDataValidations(model);\n    if (optimizedModel.length) {\n      xmlStream.openNode('dataValidations', {count: optimizedModel.length});\n\n      optimizedModel.forEach(value => {\n        xmlStream.openNode('dataValidation');\n\n        if (value.type !== 'any') {\n          xmlStream.addAttribute('type', value.type);\n\n          if (value.operator && value.type !== 'list' && value.operator !== 'between') {\n            xmlStream.addAttribute('operator', value.operator);\n          }\n          if (value.allowBlank) {\n            xmlStream.addAttribute('allowBlank', '1');\n          }\n        }\n        if (value.showInputMessage) {\n          xmlStream.addAttribute('showInputMessage', '1');\n        }\n        if (value.promptTitle) {\n          xmlStream.addAttribute('promptTitle', value.promptTitle);\n        }\n        if (value.prompt) {\n          xmlStream.addAttribute('prompt', value.prompt);\n        }\n        if (value.showErrorMessage) {\n          xmlStream.addAttribute('showErrorMessage', '1');\n        }\n        if (value.errorStyle) {\n          xmlStream.addAttribute('errorStyle', value.errorStyle);\n        }\n        if (value.errorTitle) {\n          xmlStream.addAttribute('errorTitle', value.errorTitle);\n        }\n        if (value.error) {\n          xmlStream.addAttribute('error', value.error);\n        }\n        xmlStream.addAttribute('sqref', value.sqref);\n        (value.formulae || []).forEach((formula, index) => {\n          xmlStream.openNode(`formula${index + 1}`);\n          if (value.type === 'date') {\n            xmlStream.writeText(utils.dateToExcel(new Date(formula)));\n          } else {\n            xmlStream.writeText(formula);\n          }\n          xmlStream.closeNode();\n        });\n        xmlStream.closeNode();\n      });\n      xmlStream.closeNode();\n    }\n  }\n\n  parseOpen(node) {\n    switch (node.name) {\n      case 'dataValidations':\n        this.model = {};\n        return true;\n\n      case 'dataValidation': {\n        this._address = node.attributes.sqref;\n        const dataValidation = {type: node.attributes.type || 'any', formulae: []};\n\n        if (node.attributes.type) {\n          assignBool(dataValidation, node.attributes, 'allowBlank');\n        }\n        assignBool(dataValidation, node.attributes, 'showInputMessage');\n        assignBool(dataValidation, node.attributes, 'showErrorMessage');\n\n        switch (dataValidation.type) {\n          case 'any':\n          case 'list':\n          case 'custom':\n            break;\n          default:\n            assign(dataValidation, node.attributes, 'operator', 'between');\n            break;\n        }\n        assign(dataValidation, node.attributes, 'promptTitle');\n        assign(dataValidation, node.attributes, 'prompt');\n        assign(dataValidation, node.attributes, 'errorStyle');\n        assign(dataValidation, node.attributes, 'errorTitle');\n        assign(dataValidation, node.attributes, 'error');\n\n        this._dataValidation = dataValidation;\n        return true;\n      }\n\n      case 'formula1':\n      case 'formula2':\n        this._formula = [];\n        return true;\n\n      default:\n        return false;\n    }\n  }\n\n  parseText(text) {\n    if (this._formula) {\n      this._formula.push(text);\n    }\n  }\n\n  parseClose(name) {\n    switch (name) {\n      case 'dataValidations':\n        return false;\n      case 'dataValidation': {\n        if (!this._dataValidation.formulae || !this._dataValidation.formulae.length) {\n          delete this._dataValidation.formulae;\n          delete this._dataValidation.operator;\n        }\n        // The four known cases: 1. E4:L9 N4:U9  2.E4 L9  3. N4:U9  4. E4\n        const list = this._address.split(/\\s+/g) || [];\n        list.forEach(addr => {\n          if (addr.includes(':')) {\n            const range = new Range(addr);\n            range.forEachAddress(address => {\n              this.model[address] = this._dataValidation;\n            });\n          } else {\n            this.model[addr] = this._dataValidation;\n          }\n        });\n        return true;\n      }\n      case 'formula1':\n      case 'formula2': {\n        let formula = this._formula.join('');\n        switch (this._dataValidation.type) {\n          case 'whole':\n          case 'textLength':\n            formula = parseInt(formula, 10);\n            break;\n          case 'decimal':\n            formula = parseFloat(formula);\n            break;\n          case 'date':\n            formula = utils.excelToDate(parseFloat(formula));\n            break;\n          default:\n            break;\n        }\n        this._dataValidation.formulae.push(formula);\n        this._formula = undefined;\n        return true;\n      }\n      default:\n        return true;\n    }\n  }\n}\n\nmodule.exports = DataValidationsXform;\n"],"mappings":"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"}
>>>>>>> 95bdce0e2476f31a1a1d26b5d1f458cd5295e48d
