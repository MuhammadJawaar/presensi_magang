<<<<<<< HEAD
{"version":3,"sources":["../../../../../lib/xlsx/xform/strings/shared-strings-xform.js"],"names":["XmlStream","require","BaseXform","SharedStringXform","SharedStringsXform","model","values","count","hash","Object","create","rich","index","value","richText","addRichText","addText","undefined","length","push","xml","sharedStringXform","toXml","xmlStream","_values","openXml","StdDocAttributes","openNode","xmlns","uniqueCount","sx","forEach","sharedString","render","closeNode","node","parser","parseOpen","name","Error","JSON","stringify","text","parseText","parseClose","_sharedStringXform","module","exports"],"mappings":"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","sourcesContent":["const XmlStream = require('../../../utils/xml-stream');\r\nconst BaseXform = require('../base-xform');\r\nconst SharedStringXform = require('./shared-string-xform');\r\n\r\nclass SharedStringsXform extends BaseXform {\r\n  constructor(model) {\r\n    super();\r\n\r\n    this.model = model || {\r\n      values: [],\r\n      count: 0,\r\n    };\r\n    this.hash = Object.create(null);\r\n    this.rich = Object.create(null);\r\n  }\r\n\r\n  get sharedStringXform() {\r\n    return this._sharedStringXform || (this._sharedStringXform = new SharedStringXform());\r\n  }\r\n\r\n  get values() {\r\n    return this.model.values;\r\n  }\r\n\r\n  get uniqueCount() {\r\n    return this.model.values.length;\r\n  }\r\n\r\n  get count() {\r\n    return this.model.count;\r\n  }\r\n\r\n  getString(index) {\r\n    return this.model.values[index];\r\n  }\r\n\r\n  add(value) {\r\n    return value.richText ? this.addRichText(value) : this.addText(value);\r\n  }\r\n\r\n  addText(value) {\r\n    let index = this.hash[value];\r\n    if (index === undefined) {\r\n      index = this.hash[value] = this.model.values.length;\r\n      this.model.values.push(value);\r\n    }\r\n    this.model.count++;\r\n    return index;\r\n  }\r\n\r\n  addRichText(value) {\r\n    // TODO: add WeakMap here\r\n    const xml = this.sharedStringXform.toXml(value);\r\n    let index = this.rich[xml];\r\n    if (index === undefined) {\r\n      index = this.rich[xml] = this.model.values.length;\r\n      this.model.values.push(value);\r\n    }\r\n    this.model.count++;\r\n    return index;\r\n  }\r\n\r\n  // <?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\r\n  // <sst xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\" count=\"<%=totalRefs%>\" uniqueCount=\"<%=count%>\">\r\n  //   <si><t><%=text%></t></si>\r\n  //   <si><r><rPr></rPr><t></t></r></si>\r\n  // </sst>\r\n\r\n  render(xmlStream, model) {\r\n    model = model || this._values;\r\n    xmlStream.openXml(XmlStream.StdDocAttributes);\r\n\r\n    xmlStream.openNode('sst', {\r\n      xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\r\n      count: model.count,\r\n      uniqueCount: model.values.length,\r\n    });\r\n\r\n    const sx = this.sharedStringXform;\r\n    model.values.forEach(sharedString => {\r\n      sx.render(xmlStream, sharedString);\r\n    });\r\n    xmlStream.closeNode();\r\n  }\r\n\r\n  parseOpen(node) {\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n      return true;\r\n    }\r\n    switch (node.name) {\r\n      case 'sst':\r\n        return true;\r\n      case 'si':\r\n        this.parser = this.sharedStringXform;\r\n        this.parser.parseOpen(node);\r\n        return true;\r\n      default:\r\n        throw new Error(`Unexpected xml node in parseOpen: ${JSON.stringify(node)}`);\r\n    }\r\n  }\r\n\r\n  parseText(text) {\r\n    if (this.parser) {\r\n      this.parser.parseText(text);\r\n    }\r\n  }\r\n\r\n  parseClose(name) {\r\n    if (this.parser) {\r\n      if (!this.parser.parseClose(name)) {\r\n        this.model.values.push(this.parser.model);\r\n        this.model.count++;\r\n        this.parser = undefined;\r\n      }\r\n      return true;\r\n    }\r\n    switch (name) {\r\n      case 'sst':\r\n        return false;\r\n      default:\r\n        throw new Error(`Unexpected xml node in parseClose: ${name}`);\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = SharedStringsXform;\r\n"],"file":"shared-strings-xform.js"}
=======
{"version":3,"file":"shared-strings-xform.js","names":["XmlStream","require","BaseXform","SharedStringXform","SharedStringsXform","constructor","model","values","count","hash","Object","create","rich","sharedStringXform","_sharedStringXform","uniqueCount","length","getString","index","add","value","richText","addRichText","addText","undefined","push","xml","toXml","render","xmlStream","_values","openXml","StdDocAttributes","openNode","xmlns","sx","forEach","sharedString","closeNode","parseOpen","node","parser","name","Error","JSON","stringify","parseText","text","parseClose","module","exports"],"sources":["../../../../../lib/xlsx/xform/strings/shared-strings-xform.js"],"sourcesContent":["const XmlStream = require('../../../utils/xml-stream');\nconst BaseXform = require('../base-xform');\nconst SharedStringXform = require('./shared-string-xform');\n\nclass SharedStringsXform extends BaseXform {\n  constructor(model) {\n    super();\n\n    this.model = model || {\n      values: [],\n      count: 0,\n    };\n    this.hash = Object.create(null);\n    this.rich = Object.create(null);\n  }\n\n  get sharedStringXform() {\n    return this._sharedStringXform || (this._sharedStringXform = new SharedStringXform());\n  }\n\n  get values() {\n    return this.model.values;\n  }\n\n  get uniqueCount() {\n    return this.model.values.length;\n  }\n\n  get count() {\n    return this.model.count;\n  }\n\n  getString(index) {\n    return this.model.values[index];\n  }\n\n  add(value) {\n    return value.richText ? this.addRichText(value) : this.addText(value);\n  }\n\n  addText(value) {\n    let index = this.hash[value];\n    if (index === undefined) {\n      index = this.hash[value] = this.model.values.length;\n      this.model.values.push(value);\n    }\n    this.model.count++;\n    return index;\n  }\n\n  addRichText(value) {\n    // TODO: add WeakMap here\n    const xml = this.sharedStringXform.toXml(value);\n    let index = this.rich[xml];\n    if (index === undefined) {\n      index = this.rich[xml] = this.model.values.length;\n      this.model.values.push(value);\n    }\n    this.model.count++;\n    return index;\n  }\n\n  // <?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n  // <sst xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\" count=\"<%=totalRefs%>\" uniqueCount=\"<%=count%>\">\n  //   <si><t><%=text%></t></si>\n  //   <si><r><rPr></rPr><t></t></r></si>\n  // </sst>\n\n  render(xmlStream, model) {\n    model = model || this._values;\n    xmlStream.openXml(XmlStream.StdDocAttributes);\n\n    xmlStream.openNode('sst', {\n      xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\n      count: model.count,\n      uniqueCount: model.values.length,\n    });\n\n    const sx = this.sharedStringXform;\n    model.values.forEach(sharedString => {\n      sx.render(xmlStream, sharedString);\n    });\n    xmlStream.closeNode();\n  }\n\n  parseOpen(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n    switch (node.name) {\n      case 'sst':\n        return true;\n      case 'si':\n        this.parser = this.sharedStringXform;\n        this.parser.parseOpen(node);\n        return true;\n      default:\n        throw new Error(`Unexpected xml node in parseOpen: ${JSON.stringify(node)}`);\n    }\n  }\n\n  parseText(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  }\n\n  parseClose(name) {\n    if (this.parser) {\n      if (!this.parser.parseClose(name)) {\n        this.model.values.push(this.parser.model);\n        this.model.count++;\n        this.parser = undefined;\n      }\n      return true;\n    }\n    switch (name) {\n      case 'sst':\n        return false;\n      default:\n        throw new Error(`Unexpected xml node in parseClose: ${name}`);\n    }\n  }\n}\n\nmodule.exports = SharedStringsXform;\n"],"mappings":"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"}
>>>>>>> 95bdce0e2476f31a1a1d26b5d1f458cd5295e48d
