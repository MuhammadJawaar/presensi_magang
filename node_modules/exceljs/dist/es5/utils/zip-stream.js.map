<<<<<<< HEAD
{"version":3,"sources":["../../../lib/utils/zip-stream.js"],"names":["events","require","JSZip","StreamBuf","stringToBuffer","ZipWriter","options","Object","assign","type","compression","zip","stream","data","hasOwnProperty","base64","file","name","process","browser","generateAsync","content","end","emit","size","read","encoding","setEncoding","pause","resume","isPaused","destination","pipe","unpipe","chunk","unshift","wrap","EventEmitter","module","exports"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,MAAM,GAAGC,OAAO,CAAC,QAAD,CAAtB;;AACA,IAAMC,KAAK,GAAGD,OAAO,CAAC,OAAD,CAArB;;AAEA,IAAME,SAAS,GAAGF,OAAO,CAAC,cAAD,CAAzB;;eACyBA,OAAO,CAAC,yBAAD,C;IAAzBG,c,YAAAA,c,EAEP;AACA;AACA;;;IACMC,S;;;;;AACJ,qBAAYC,OAAZ,EAAqB;AAAA;;AAAA;;AACnB;AACA,UAAKA,OAAL,GAAeC,MAAM,CAACC,MAAP,CACb;AACEC,MAAAA,IAAI,EAAE,YADR;AAEEC,MAAAA,WAAW,EAAE;AAFf,KADa,EAKbJ,OALa,CAAf;AAQA,UAAKK,GAAL,GAAW,IAAIT,KAAJ,EAAX;AACA,UAAKU,MAAL,GAAc,IAAIT,SAAJ,EAAd;AAXmB;AAYpB;;;;2BAEMU,I,EAAMP,O,EAAS;AACpB,UAAIA,OAAO,CAACQ,cAAR,CAAuB,QAAvB,KAAoCR,OAAO,CAACS,MAAhD,EAAwD;AACtD,aAAKJ,GAAL,CAASK,IAAT,CAAcV,OAAO,CAACW,IAAtB,EAA4BJ,IAA5B,EAAkC;AAACE,UAAAA,MAAM,EAAE;AAAT,SAAlC;AACD,OAFD,MAEO;AACL;AACA,YAAIG,OAAO,CAACC,OAAR,IAAmB,OAAON,IAAP,KAAgB,QAAvC,EAAiD;AAC/C;AACAA,UAAAA,IAAI,GAAGT,cAAc,CAACS,IAAD,CAArB;AACD;;AACD,aAAKF,GAAL,CAASK,IAAT,CAAcV,OAAO,CAACW,IAAtB,EAA4BJ,IAA5B;AACD;AACF;;;;;;;;;;;uBAGuB,KAAKF,GAAL,CAASS,aAAT,CAAuB,KAAKd,OAA5B,C;;;AAAhBe,gBAAAA,O;AACN,qBAAKT,MAAL,CAAYU,GAAZ,CAAgBD,OAAhB;AACA,qBAAKE,IAAL,CAAU,QAAV;;;;;;;;;;;;;;;QAGF;AACA;;;;yBACKC,I,EAAM;AACT,aAAO,KAAKZ,MAAL,CAAYa,IAAZ,CAAiBD,IAAjB,CAAP;AACD;;;gCAEWE,Q,EAAU;AACpB,aAAO,KAAKd,MAAL,CAAYe,WAAZ,CAAwBD,QAAxB,CAAP;AACD;;;4BAEO;AACN,aAAO,KAAKd,MAAL,CAAYgB,KAAZ,EAAP;AACD;;;6BAEQ;AACP,aAAO,KAAKhB,MAAL,CAAYiB,MAAZ,EAAP;AACD;;;+BAEU;AACT,aAAO,KAAKjB,MAAL,CAAYkB,QAAZ,EAAP;AACD;;;yBAEIC,W,EAAazB,O,EAAS;AACzB,aAAO,KAAKM,MAAL,CAAYoB,IAAZ,CAAiBD,WAAjB,EAA8BzB,OAA9B,CAAP;AACD;;;2BAEMyB,W,EAAa;AAClB,aAAO,KAAKnB,MAAL,CAAYqB,MAAZ,CAAmBF,WAAnB,CAAP;AACD;;;4BAEOG,K,EAAO;AACb,aAAO,KAAKtB,MAAL,CAAYuB,OAAZ,CAAoBD,KAApB,CAAP;AACD;;;yBAEItB,M,EAAQ;AACX,aAAO,KAAKA,MAAL,CAAYwB,IAAZ,CAAiBxB,MAAjB,CAAP;AACD;;;;EAtEqBZ,MAAM,CAACqC,Y,GAyE/B;;;AAEAC,MAAM,CAACC,OAAP,GAAiB;AACflC,EAAAA,SAAS,EAATA;AADe,CAAjB","sourcesContent":["const events = require('events');\r\nconst JSZip = require('jszip');\r\n\r\nconst StreamBuf = require('./stream-buf');\r\nconst {stringToBuffer} = require('./browser-buffer-encode');\r\n\r\n// =============================================================================\r\n// The ZipWriter class\r\n// Packs streamed data into an output zip stream\r\nclass ZipWriter extends events.EventEmitter {\r\n  constructor(options) {\r\n    super();\r\n    this.options = Object.assign(\r\n      {\r\n        type: 'nodebuffer',\r\n        compression: 'DEFLATE',\r\n      },\r\n      options\r\n    );\r\n\r\n    this.zip = new JSZip();\r\n    this.stream = new StreamBuf();\r\n  }\r\n\r\n  append(data, options) {\r\n    if (options.hasOwnProperty('base64') && options.base64) {\r\n      this.zip.file(options.name, data, {base64: true});\r\n    } else {\r\n      // https://www.npmjs.com/package/process\r\n      if (process.browser && typeof data === 'string') {\r\n        // use TextEncoder in browser\r\n        data = stringToBuffer(data);\r\n      }\r\n      this.zip.file(options.name, data);\r\n    }\r\n  }\r\n\r\n  async finalize() {\r\n    const content = await this.zip.generateAsync(this.options);\r\n    this.stream.end(content);\r\n    this.emit('finish');\r\n  }\r\n\r\n  // ==========================================================================\r\n  // Stream.Readable interface\r\n  read(size) {\r\n    return this.stream.read(size);\r\n  }\r\n\r\n  setEncoding(encoding) {\r\n    return this.stream.setEncoding(encoding);\r\n  }\r\n\r\n  pause() {\r\n    return this.stream.pause();\r\n  }\r\n\r\n  resume() {\r\n    return this.stream.resume();\r\n  }\r\n\r\n  isPaused() {\r\n    return this.stream.isPaused();\r\n  }\r\n\r\n  pipe(destination, options) {\r\n    return this.stream.pipe(destination, options);\r\n  }\r\n\r\n  unpipe(destination) {\r\n    return this.stream.unpipe(destination);\r\n  }\r\n\r\n  unshift(chunk) {\r\n    return this.stream.unshift(chunk);\r\n  }\r\n\r\n  wrap(stream) {\r\n    return this.stream.wrap(stream);\r\n  }\r\n}\r\n\r\n// =============================================================================\r\n\r\nmodule.exports = {\r\n  ZipWriter,\r\n};\r\n"],"file":"zip-stream.js"}
=======
{"version":3,"file":"zip-stream.js","names":["events","require","JSZip","StreamBuf","stringToBuffer","ZipWriter","EventEmitter","constructor","options","Object","assign","type","compression","zip","stream","append","data","hasOwnProperty","base64","file","name","process","browser","finalize","content","generateAsync","end","emit","read","size","setEncoding","encoding","pause","resume","isPaused","pipe","destination","unpipe","unshift","chunk","wrap","module","exports"],"sources":["../../../lib/utils/zip-stream.js"],"sourcesContent":["const events = require('events');\nconst JSZip = require('jszip');\n\nconst StreamBuf = require('./stream-buf');\nconst {stringToBuffer} = require('./browser-buffer-encode');\n\n// =============================================================================\n// The ZipWriter class\n// Packs streamed data into an output zip stream\nclass ZipWriter extends events.EventEmitter {\n  constructor(options) {\n    super();\n    this.options = Object.assign(\n      {\n        type: 'nodebuffer',\n        compression: 'DEFLATE',\n      },\n      options\n    );\n\n    this.zip = new JSZip();\n    this.stream = new StreamBuf();\n  }\n\n  append(data, options) {\n    if (options.hasOwnProperty('base64') && options.base64) {\n      this.zip.file(options.name, data, {base64: true});\n    } else {\n      // https://www.npmjs.com/package/process\n      if (process.browser && typeof data === 'string') {\n        // use TextEncoder in browser\n        data = stringToBuffer(data);\n      }\n      this.zip.file(options.name, data);\n    }\n  }\n\n  async finalize() {\n    const content = await this.zip.generateAsync(this.options);\n    this.stream.end(content);\n    this.emit('finish');\n  }\n\n  // ==========================================================================\n  // Stream.Readable interface\n  read(size) {\n    return this.stream.read(size);\n  }\n\n  setEncoding(encoding) {\n    return this.stream.setEncoding(encoding);\n  }\n\n  pause() {\n    return this.stream.pause();\n  }\n\n  resume() {\n    return this.stream.resume();\n  }\n\n  isPaused() {\n    return this.stream.isPaused();\n  }\n\n  pipe(destination, options) {\n    return this.stream.pipe(destination, options);\n  }\n\n  unpipe(destination) {\n    return this.stream.unpipe(destination);\n  }\n\n  unshift(chunk) {\n    return this.stream.unshift(chunk);\n  }\n\n  wrap(stream) {\n    return this.stream.wrap(stream);\n  }\n}\n\n// =============================================================================\n\nmodule.exports = {\n  ZipWriter,\n};\n"],"mappings":";;AAAA,MAAMA,MAAM,GAAGC,OAAO,CAAC,QAAQ,CAAC;AAChC,MAAMC,KAAK,GAAGD,OAAO,CAAC,OAAO,CAAC;AAE9B,MAAME,SAAS,GAAGF,OAAO,CAAC,cAAc,CAAC;AACzC,MAAM;EAACG;AAAc,CAAC,GAAGH,OAAO,CAAC,yBAAyB,CAAC;;AAE3D;AACA;AACA;AACA,MAAMI,SAAS,SAASL,MAAM,CAACM,YAAY,CAAC;EAC1CC,WAAWA,CAACC,OAAO,EAAE;IACnB,KAAK,CAAC,CAAC;IACP,IAAI,CAACA,OAAO,GAAGC,MAAM,CAACC,MAAM,CAC1B;MACEC,IAAI,EAAE,YAAY;MAClBC,WAAW,EAAE;IACf,CAAC,EACDJ,OACF,CAAC;IAED,IAAI,CAACK,GAAG,GAAG,IAAIX,KAAK,CAAC,CAAC;IACtB,IAAI,CAACY,MAAM,GAAG,IAAIX,SAAS,CAAC,CAAC;EAC/B;EAEAY,MAAMA,CAACC,IAAI,EAAER,OAAO,EAAE;IACpB,IAAIA,OAAO,CAACS,cAAc,CAAC,QAAQ,CAAC,IAAIT,OAAO,CAACU,MAAM,EAAE;MACtD,IAAI,CAACL,GAAG,CAACM,IAAI,CAACX,OAAO,CAACY,IAAI,EAAEJ,IAAI,EAAE;QAACE,MAAM,EAAE;MAAI,CAAC,CAAC;IACnD,CAAC,MAAM;MACL;MACA,IAAIG,OAAO,CAACC,OAAO,IAAI,OAAON,IAAI,KAAK,QAAQ,EAAE;QAC/C;QACAA,IAAI,GAAGZ,cAAc,CAACY,IAAI,CAAC;MAC7B;MACA,IAAI,CAACH,GAAG,CAACM,IAAI,CAACX,OAAO,CAACY,IAAI,EAAEJ,IAAI,CAAC;IACnC;EACF;EAEA,MAAMO,QAAQA,CAAA,EAAG;IACf,MAAMC,OAAO,GAAG,MAAM,IAAI,CAACX,GAAG,CAACY,aAAa,CAAC,IAAI,CAACjB,OAAO,CAAC;IAC1D,IAAI,CAACM,MAAM,CAACY,GAAG,CAACF,OAAO,CAAC;IACxB,IAAI,CAACG,IAAI,CAAC,QAAQ,CAAC;EACrB;;EAEA;EACA;EACAC,IAAIA,CAACC,IAAI,EAAE;IACT,OAAO,IAAI,CAACf,MAAM,CAACc,IAAI,CAACC,IAAI,CAAC;EAC/B;EAEAC,WAAWA,CAACC,QAAQ,EAAE;IACpB,OAAO,IAAI,CAACjB,MAAM,CAACgB,WAAW,CAACC,QAAQ,CAAC;EAC1C;EAEAC,KAAKA,CAAA,EAAG;IACN,OAAO,IAAI,CAAClB,MAAM,CAACkB,KAAK,CAAC,CAAC;EAC5B;EAEAC,MAAMA,CAAA,EAAG;IACP,OAAO,IAAI,CAACnB,MAAM,CAACmB,MAAM,CAAC,CAAC;EAC7B;EAEAC,QAAQA,CAAA,EAAG;IACT,OAAO,IAAI,CAACpB,MAAM,CAACoB,QAAQ,CAAC,CAAC;EAC/B;EAEAC,IAAIA,CAACC,WAAW,EAAE5B,OAAO,EAAE;IACzB,OAAO,IAAI,CAACM,MAAM,CAACqB,IAAI,CAACC,WAAW,EAAE5B,OAAO,CAAC;EAC/C;EAEA6B,MAAMA,CAACD,WAAW,EAAE;IAClB,OAAO,IAAI,CAACtB,MAAM,CAACuB,MAAM,CAACD,WAAW,CAAC;EACxC;EAEAE,OAAOA,CAACC,KAAK,EAAE;IACb,OAAO,IAAI,CAACzB,MAAM,CAACwB,OAAO,CAACC,KAAK,CAAC;EACnC;EAEAC,IAAIA,CAAC1B,MAAM,EAAE;IACX,OAAO,IAAI,CAACA,MAAM,CAAC0B,IAAI,CAAC1B,MAAM,CAAC;EACjC;AACF;;AAEA;;AAEA2B,MAAM,CAACC,OAAO,GAAG;EACfrC;AACF,CAAC"}
>>>>>>> 95bdce0e2476f31a1a1d26b5d1f458cd5295e48d
