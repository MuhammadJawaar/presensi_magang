"use strict";

<<<<<<< HEAD
var fs = require('fs'); // useful stuff


var inherits = function inherits(cls, superCtor, statics, prototype) {
  // eslint-disable-next-line no-underscore-dangle
  cls.super_ = superCtor;

=======
const fs = require('fs');

// useful stuff
const inherits = function (cls, superCtor, statics, prototype) {
  // eslint-disable-next-line no-underscore-dangle
  cls.super_ = superCtor;
>>>>>>> 95bdce0e2476f31a1a1d26b5d1f458cd5295e48d
  if (!prototype) {
    prototype = statics;
    statics = null;
  }
<<<<<<< HEAD

  if (statics) {
    Object.keys(statics).forEach(function (i) {
      Object.defineProperty(cls, i, Object.getOwnPropertyDescriptor(statics, i));
    });
  }

  var properties = {
=======
  if (statics) {
    Object.keys(statics).forEach(i => {
      Object.defineProperty(cls, i, Object.getOwnPropertyDescriptor(statics, i));
    });
  }
  const properties = {
>>>>>>> 95bdce0e2476f31a1a1d26b5d1f458cd5295e48d
    constructor: {
      value: cls,
      enumerable: false,
      writable: false,
      configurable: true
    }
  };
<<<<<<< HEAD

  if (prototype) {
    Object.keys(prototype).forEach(function (i) {
      properties[i] = Object.getOwnPropertyDescriptor(prototype, i);
    });
  }

  cls.prototype = Object.create(superCtor.prototype, properties);
}; // eslint-disable-next-line no-control-regex


var xmlDecodeRegex = /[<>&'"\x7F\x00-\x08\x0B-\x0C\x0E-\x1F]/;
var utils = {
  nop: function nop() {},
  promiseImmediate: function promiseImmediate(value) {
    return new Promise(function (resolve) {
      if (global.setImmediate) {
        setImmediate(function () {
=======
  if (prototype) {
    Object.keys(prototype).forEach(i => {
      properties[i] = Object.getOwnPropertyDescriptor(prototype, i);
    });
  }
  cls.prototype = Object.create(superCtor.prototype, properties);
};

// eslint-disable-next-line no-control-regex
const xmlDecodeRegex = /[<>&'"\x7F\x00-\x08\x0B-\x0C\x0E-\x1F]/;
const utils = {
  nop() {},
  promiseImmediate(value) {
    return new Promise(resolve => {
      if (global.setImmediate) {
        setImmediate(() => {
>>>>>>> 95bdce0e2476f31a1a1d26b5d1f458cd5295e48d
          resolve(value);
        });
      } else {
        // poorman's setImmediate - must wait at least 1ms
<<<<<<< HEAD
        setTimeout(function () {
=======
        setTimeout(() => {
>>>>>>> 95bdce0e2476f31a1a1d26b5d1f458cd5295e48d
          resolve(value);
        }, 1);
      }
    });
  },
<<<<<<< HEAD
  inherits: inherits,
  dateToExcel: function dateToExcel(d, date1904) {
    return 25569 + d.getTime() / (24 * 3600 * 1000) - (date1904 ? 1462 : 0);
  },
  excelToDate: function excelToDate(v, date1904) {
    var millisecondSinceEpoch = Math.round((v - 25569 + (date1904 ? 1462 : 0)) * 24 * 3600 * 1000);
    return new Date(millisecondSinceEpoch);
  },
  parsePath: function parsePath(filepath) {
    var last = filepath.lastIndexOf('/');
=======
  inherits,
  dateToExcel(d, date1904) {
    return 25569 + d.getTime() / (24 * 3600 * 1000) - (date1904 ? 1462 : 0);
  },
  excelToDate(v, date1904) {
    const millisecondSinceEpoch = Math.round((v - 25569 + (date1904 ? 1462 : 0)) * 24 * 3600 * 1000);
    return new Date(millisecondSinceEpoch);
  },
  parsePath(filepath) {
    const last = filepath.lastIndexOf('/');
>>>>>>> 95bdce0e2476f31a1a1d26b5d1f458cd5295e48d
    return {
      path: filepath.substring(0, last),
      name: filepath.substring(last + 1)
    };
  },
<<<<<<< HEAD
  getRelsPath: function getRelsPath(filepath) {
    var path = utils.parsePath(filepath);
    return "".concat(path.path, "/_rels/").concat(path.name, ".rels");
  },
  xmlEncode: function xmlEncode(text) {
    var regexResult = xmlDecodeRegex.exec(text);
    if (!regexResult) return text;
    var result = '';
    var escape = '';
    var lastIndex = 0;
    var i = regexResult.index;

    for (; i < text.length; i++) {
      var charCode = text.charCodeAt(i);

=======
  getRelsPath(filepath) {
    const path = utils.parsePath(filepath);
    return `${path.path}/_rels/${path.name}.rels`;
  },
  xmlEncode(text) {
    const regexResult = xmlDecodeRegex.exec(text);
    if (!regexResult) return text;
    let result = '';
    let escape = '';
    let lastIndex = 0;
    let i = regexResult.index;
    for (; i < text.length; i++) {
      const charCode = text.charCodeAt(i);
>>>>>>> 95bdce0e2476f31a1a1d26b5d1f458cd5295e48d
      switch (charCode) {
        case 34:
          // "
          escape = '&quot;';
          break;
<<<<<<< HEAD

=======
>>>>>>> 95bdce0e2476f31a1a1d26b5d1f458cd5295e48d
        case 38:
          // &
          escape = '&amp;';
          break;
<<<<<<< HEAD

=======
>>>>>>> 95bdce0e2476f31a1a1d26b5d1f458cd5295e48d
        case 39:
          // '
          escape = '&apos;';
          break;
<<<<<<< HEAD

=======
>>>>>>> 95bdce0e2476f31a1a1d26b5d1f458cd5295e48d
        case 60:
          // <
          escape = '&lt;';
          break;
<<<<<<< HEAD

=======
>>>>>>> 95bdce0e2476f31a1a1d26b5d1f458cd5295e48d
        case 62:
          // >
          escape = '&gt;';
          break;
<<<<<<< HEAD

        case 127:
          escape = '';
          break;

=======
        case 127:
          escape = '';
          break;
>>>>>>> 95bdce0e2476f31a1a1d26b5d1f458cd5295e48d
        default:
          {
            if (charCode <= 31 && (charCode <= 8 || charCode >= 11 && charCode !== 13)) {
              escape = '';
              break;
            }
<<<<<<< HEAD

            continue;
          }
      }

=======
            continue;
          }
      }
>>>>>>> 95bdce0e2476f31a1a1d26b5d1f458cd5295e48d
      if (lastIndex !== i) result += text.substring(lastIndex, i);
      lastIndex = i + 1;
      if (escape) result += escape;
    }
<<<<<<< HEAD

    if (lastIndex !== i) return result + text.substring(lastIndex, i);
    return result;
  },
  xmlDecode: function xmlDecode(text) {
    return text.replace(/&([a-z]*);/g, function (c) {
      switch (c) {
        case '&lt;':
          return '<';

        case '&gt;':
          return '>';

        case '&amp;':
          return '&';

        case '&apos;':
          return '\'';

        case '&quot;':
          return '"';

=======
    if (lastIndex !== i) return result + text.substring(lastIndex, i);
    return result;
  },
  xmlDecode(text) {
    return text.replace(/&([a-z]*);/g, c => {
      switch (c) {
        case '&lt;':
          return '<';
        case '&gt;':
          return '>';
        case '&amp;':
          return '&';
        case '&apos;':
          return '\'';
        case '&quot;':
          return '"';
>>>>>>> 95bdce0e2476f31a1a1d26b5d1f458cd5295e48d
        default:
          return c;
      }
    });
  },
<<<<<<< HEAD
  validInt: function validInt(value) {
    var i = parseInt(value, 10);
    return !Number.isNaN(i) ? i : 0;
  },
  isDateFmt: function isDateFmt(fmt) {
    if (!fmt) {
      return false;
    } // must remove all chars inside quotes and []


    fmt = fmt.replace(/\[[^\]]*]/g, '');
    fmt = fmt.replace(/"[^"]*"/g, ''); // then check for date formatting chars

    var result = fmt.match(/[ymdhMsb]+/) !== null;
    return result;
  },
  fs: {
    exists: function exists(path) {
      return new Promise(function (resolve) {
        fs.access(path, fs.constants.F_OK, function (err) {
=======
  validInt(value) {
    const i = parseInt(value, 10);
    return !Number.isNaN(i) ? i : 0;
  },
  isDateFmt(fmt) {
    if (!fmt) {
      return false;
    }

    // must remove all chars inside quotes and []
    fmt = fmt.replace(/\[[^\]]*]/g, '');
    fmt = fmt.replace(/"[^"]*"/g, '');
    // then check for date formatting chars
    const result = fmt.match(/[ymdhMsb]+/) !== null;
    return result;
  },
  fs: {
    exists(path) {
      return new Promise(resolve => {
        fs.access(path, fs.constants.F_OK, err => {
>>>>>>> 95bdce0e2476f31a1a1d26b5d1f458cd5295e48d
          resolve(!err);
        });
      });
    }
  },
<<<<<<< HEAD
  toIsoDateString: function toIsoDateString(dt) {
    return dt.toIsoString().subsstr(0, 10);
=======
  toIsoDateString(dt) {
    return dt.toIsoString().subsstr(0, 10);
  },
  parseBoolean(value) {
    return value === true || value === 'true' || value === 1 || value === '1';
>>>>>>> 95bdce0e2476f31a1a1d26b5d1f458cd5295e48d
  }
};
module.exports = utils;
//# sourceMappingURL=utils.js.map
